{% extends 'base.html' %}
{% load staticfiles %}

{% block bodyclass %}page lightmonitor{%endblock%}

{%block header %}Light Monitor for block {{object.id}}{%endblock%}

{% block script-content %}
<script src="https://code.createjs.com/createjs-2015.11.26.min.js"  type="text/javascript" ></script>
<script src="{% static "core/js/astrometer.js" %}"  type="text/javascript" ></script>
<script>
	var stage;
	var ministage;
	var index = 0;
	var point_size = 10;
	var blinker;
	var img_holder;
	var mini_img;
	var frames = {{images|safe}}
	var data_url = 'https://thumbnails.lcogt.net/'
	var img_params = '?width=1000&height=1000'

	$(document).ready(function(){

		loadThumbnails(frames);
		setUp();

    // $.when.apply(null, deferreds).done(function() {
		// 	setUp();
		// });

	});

</script>
{% endblock %}

{% block upper-menu%}

{%endblock%}

{% block extramenu %}
    <div class="headingleft">
        <h1>Light Monitor for block: <a href="{% url 'block-view' object.id  %}" class="objectspecific">#{{object.id}}</a></h1>
    </div>
{% endblock%}

{% block main-content %}
<!-- Main body -->
<div class="container" id="main">
        <div class="row">
            <div class="eight columns">
                <h3 class="section-title">Find the moving object!</h3>
{% if messages %}					<div id="message">
						<ul class="messages">
{% for message in messages %}{%ifchanged%}<li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message|safe }}</li>{%endifchanged%}{% endfor %}
						</ul>
					</div>{% endif %}

					<div id="middle">
						<div id="image-loading">
							<i class="fa fa-refresh fa-spin fa-8x fa-fw"></i>
							<span class="sr-only">Loading Image...</span>
						</div>
						<div id="wrapper">
							<canvas id="imgCanvas" width="600" height="600" src=""><p>Image has failed to load.</p></canvas>
						</div>
					</div>
				</div>

        <div class="four columns">
					<h3 class="section-title">Zoom Region</h3>
					<canvas id="zoomCanvas" width="200" height="200"><p>Image has failed to load.</p></canvas>

          {% if images %}
          <h3 class="section-title">Controls</h3>
							<div class="button-holder">
								<button id="start" onclick="prevImage();"><i class="fa fa-arrow-circle-o-left" aria-hidden="true"></i></button>
								<span id="current_image_index"></span> of <span id="number_images"></span>
								<button id="stop" onclick="nextImage();"><i class="fa fa-arrow-circle-o-right" aria-hidden="true"></i></button>
							</div>
							<div class="button-holder">
								<button id="blink-start" onclick="startBlink();">Blink On</button>
								<button id="blink-stop" onclick="stopBlink();">Blink Off</button>
							</div>
          {% endif %}
        </div>
      </div>
    </div>
{% endblock %}
