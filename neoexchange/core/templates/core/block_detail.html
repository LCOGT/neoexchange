{% extends 'base.html' %}
{% load staticfiles %}

{% block header %}
    {% if object.cadence %}
    Cadence details
    {% else %}
    Block details
    {% endif %}
{% endblock %}

{% block script-content %}
{% endblock %}

{% block bodyclass %}page{% endblock %}

{% block extramenu %}
    <div class="headingleft">
        <h1>Block: {{object.pk}}</h1>
    </div>
{% endblock%}

{% block main-content %}
    <!-- Main body -->
    <div class="container" id="main">
            <div class="row">
                <div class="eight columns">
                    {% if object.cadence %}
                        <h5 class="section-title">Details of the Cadence</h5>
                    {% else %}
                         <h5 class="section-title">Details of the Block</h5>
                    {% endif %}
                    <table class="keyvalue-table" id="id_blockdetail">
                        <tbody>
                            <tr>
                                <td class="kv-key">Telescope class</td>
                                <td class="kv-value">{{object.telclass}}</td>
                            </tr>
                            <tr>
                                <td class="kv-key">Site</td>
                                <td class="kv-value">{{object.site|upper}}</td>
                            </tr>
                            <tr>
                                <td class="kv-key">Body</td>
                                <td class="kv-value"><a href="{% url 'target' object.body.pk %}">{{object.body.current_name}}</a></td>
                            </tr>
                            <tr>
                                <td class="kv-key">Proposal</td>
                                <td class="kv-value">{{object.proposal.title}} ({{object.proposal.code}})</td>
                            </tr>
                            <tr>
                                <td class="kv-key">Block start</td>
                                <td class="kv-value">{{object.block_start|date:"Y-m-d H:i"}}</td>
                            </tr>
                            <tr>
                                <td class="kv-key">Block end</td>
                                <td class="kv-value">{{object.block_end|date:"Y-m-d H:i"}}</td>
                            </tr>
                            <tr>
                                <td class="kv-key">Tracking number</td>
                                <td class="kv-value"><a href="{{object.make_obsblock_link}}">{{object.tracking_number}}</a></td>
                            </tr>
                            <tr>
                                <td class="kv-key">Number of exposures</td>
                                <td class="kv-value">{{object.get_obsdetails}}</td>
                            </tr>
                            <tr>
                                <td class="kv-key">Last observed</td>
                                <td class="kv-value">{% if object.get_num_observed.0 > 0 %}{{object.get_last_observed|date:"Y-m-d H:i"}}{% else %}Not Observed{% endif %}</td>
                            </tr>
                            <tr>
                                <td class="kv-key">Active?</td>
                                <td class="kv-value"><span class="">{% if object.active %}<span class="warning msgpadded">Active</span>{% else %}Not Active{% endif %}</span></td>
                            </tr>
                            <tr>
                                <td class="kv-key">Reported?</td>
                                <td class="kv-value"><span class="">{% if object.get_num_reported.0 > 0 %}<span class="warning msgpadded">Reported</span>{% else %}Not Reported{% endif %}</span></td>
                            </tr>
                            <tr>
                                <td class="kv-key">When Reported</td>
                                <td class="kv-value"><span class="">{% if object.get_num_reported.0 > 0 %}<span class="warning msgpadded">{{object.get_last_reported|date:"Y-m-d H:i"}}</span>{% else %}Not Reported{% endif %}</span></td>
                            </tr>
                      </tbody>
                    </table>
                </div>
                <div class="four columns">
                    <h5 class="section-title">Controls</h5>
                        {% if request.user.is_authenticated %}
                          {% if object.num_observed > 0 and object.num_frames < 10 and object.num_candidates > 0 %}
                            <a class="button button-primary" href="{% url 'block-ast' object.id %}" id="analyse-btn">Analyse Images</a><br/>
                            {% if not object.reported %}
                            <a class="button button-primary" href="{% url 'block-report' object.id %}">Report</a><br/>
                            {% endif %}
                            {% if object.num_candidates > 0 %}
                              <a class="button button-primary" href="{% url 'view-candidates' object.id %}">Candidates ({{object.num_candidates}})</a><br/>
                            {% endif %}
                          {% elif object.reported %}
                            <a class="button button-primary" href="{% url 'block-report-mpc' object.id %}">View report in MPC format</a><br/>
                            <a class="button button-primary" href="{% url 'upload-report' object.id %}">Upload MPC format</a>
                          {% elif not object.reported %}
                          <a class="button button-primary" href="{% url 'report-block' object.id %}">Mark as Reported</a><br/>
                          {%else%}
                          No actions available
                          {% endif %}
                        {% else %}
                        <a href="{% url 'auth_login' %}?next={{request.path}}">Log in to see actions</a>
                        {% endif %}
                </div>
            </div>
        </div>
{% endblock %}
